---
title: "CDC Daily by State"
author: "davegoblue"
date: "2/20/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Background
This file is designed to use CDC data to assess coronavirus disease burden by state, including creating and analyzing state-level clusters.

Through March 7, 2021, [The COVID Tracking Project](https://covidtracking.com/) collected and integrated data on tests, cases, hospitalizations, deaths, and the like by state and date.  The latest code for using this data is available in Coronavirus_Statistics_CTP_v004.Rmd.

The COVID Tracking Project suggest that [US federal data sources](https://covidtracking.com/analysis-updates/federal-covid-data-101-how-to-find-data) are now sufficiently robust to be used for analyses that previously relied on COVID Tracking Project.  This code is an attempt to update modules in Coronavirus_Statistics_CTP_v004.Rmd to leverage US federal data.

The code in this module builds on code available in _v003, with function and mapping files updated:  
  
* Generic_Added_Utility_Functions_202105_v001.R - generic functions that can be used in other areas  
* Coronavirus_CDC_Daily_Functions_v001.R - functions specific to coronavirus daily data  
  
Broadly, the CDC data analyzed by this module includes:  
  
* CDC case and death data by state and date are available for download on the [CDC website](https://data.cdc.gov/api/views/9mfq-cb36/rows.csv?accessType=DOWNLOAD)  
* CDC hospital data are available for download on the [healthdata.gov website](https://beta.healthdata.gov/api/views/g62h-syeh/rows.csv?accessType=DOWNLOAD)  
* CDC vaccines data are also available for download on the [CDC website](https://data.cdc.gov/api/views/unsk-b7fc/rows.csv?accessType=DOWNLOAD):  
  
## Functions and Mapping Files
The tidyverse package is loaded and functions are sourced:  
```{r}

# The tidyverse functions are routinely used without package::function format
library(tidyverse)
library(geofacet)

# Functions are available in source file
source("./Generic_Added_Utility_Functions_202105_v001.R")
source("./Coronavirus_CDC_Daily_Functions_v001.R")

```

A series of mapping files are also available to allow for parameterized processing.  Mappings include:  
  
* urlMapper - mapping file for urlType and url location to download data  
* renMapper - mapping file for renaming of variables in the raw data file  
* selfListMapper - mapping file for transformations by variable type  
* fullListMapper - mapping file for transformations across variable types  
* lstComboMapper - mapping file for elements to be combined by data type (most common is to combine NYC and NYS data to NY if the file provides them separately)  
* uqMapper - mapping file for fields that should combine to be unique keys for processed files  
* lstFilterMapper - mapping file for filtering to subset (most common is to keep 50 states and DC)  
* vecSelectMapper - mapping file for variables to keep  
* checkControlGroupMapper - mapping file for group_by() of control total checks  
* checkControlAggMapper - mapping file for numeric variables for control total checks  
* checkSimilarityMapper - mapping file for similarity checks to perform  
* plotSimilarityMaooer - mapping file for fields where differences in universe should be plotted
* keyAggMapper - mapping file for the aggregate-level control total checks to perform  
* perCapMapper - named vector that drives conversion from original field name to per capita field name  
* hhsMapper - named vector that drivers numerical variables to keep (and renaming) from HHS capacity data file
  
These default parameters are maintained in a separate .R file and can be sourced:  
```{r}

source("./Coronavirus_CDC_Daily_Default_Mappings_v002.R")

```

## Example Code Processing
The function is run to download and process the latest CDC case, hospitalization, and death data:  
```{r, fig.height=9, fig.width=9, cache=TRUE}

readList <- list("cdcDaily"="./RInputFiles/Coronavirus/CDC_dc_downloaded_220220.csv", 
                 "cdcHosp"="./RInputFiles/Coronavirus/CDC_h_downloaded_220220.csv", 
                 "vax"="./RInputFiles/Coronavirus/vaxData_downloaded_220220.csv"
                 )
compareList <- list("cdcDaily"=readFromRDS("cdc_daily_220206")$dfRaw$cdcDaily, 
                    "cdcHosp"=readFromRDS("cdc_daily_220206")$dfRaw$cdcHosp, 
                    "vax"=readFromRDS("cdc_daily_220206")$dfRaw$vax
                    )

cdc_daily_220220 <- readRunCDCDaily(thruLabel="Feb 18, 2022", 
                                    downloadTo=lapply(readList, FUN=function(x) if(file.exists(x)) NA else x), 
                                    readFrom=readList,
                                    compareFile=compareList, 
                                    writeLog=NULL, 
                                    useClusters=readFromRDS("cdc_daily_210528")$useClusters, 
                                    weightedMeanAggs=c("tcpm7", "tdpm7", "cpm7", "dpm7", "hpm7", 
                                                       "vxcpm7", "vxcgte65pct"
                                                       ),
                                    skipAssessmentPlots=FALSE, 
                                    brewPalette="Paired"
                                    )

saveToRDS(cdc_daily_220220, ovrWriteError=FALSE)

```
  
The latest hospital data are downloaded:  
```{r, fig.height=9, fig.width=9, cache=TRUE}

# Run for latest data, save as RDS
indivHosp_20220221 <- downloadReadHospitalData(loc="./RInputFiles/Coronavirus/HHS_Hospital_20220221.csv")
saveToRDS(indivHosp_20220221, ovrWriteError=FALSE)

```
  
The post-processing capabilities are included:  
```{r, fig.height=9, fig.width=9}

# Create pivoted burden data
burdenPivotList_220220 <- postProcessCDCDaily(cdc_daily_220220, 
                                              dataThruLabel="Jan 2022", 
                                              keyDatesBurden=c("2022-01-31", "2021-07-31", 
                                                               "2021-01-31", "2020-07-31"
                                                               ),
                                              keyDatesVaccine=c("2021-12-31", "2021-09-30", 
                                                                "2021-06-30", "2021-03-31"
                                                                ), 
                                              returnData=TRUE
                                              )

```

The hospital summaries are also added:  
```{r, fig.height=9, fig.width=9}

# Can be run only as-needed
dfStateAgeBucket2019 <- readPopStateAge("./RInputFiles/sc-est2019-agesex-civ.csv") %>%
    filterPopStateAge(keyCol="POPEST2019_CIV", keyColName="pop2019") %>%
    bucketPopStateAge(popVar="pop2019")

# Create hospitalized per capita data
hospPerCap_220220 <- hospAgePerCapita(dfStateAgeBucket2019, 
                                      lst=burdenPivotList_220220, 
                                      popVar="pop2019", 
                                      excludeState=c(), 
                                      cumStartDate="2020-07-15"
                                      )

```

The one-page CFR plot capability is included:  
```{r, fig.height=9, fig.width=9}

# Create CFR plots for select states
cfrStates <- list("FL"=list(keyState="FL", minDate="2020-08-01", multDeath=70), 
                  "LA"=list(keyState="LA", minDate="2020-08-01", multDeath=80), 
                  "CA"=list(keyState="CA", minDate="2020-08-01", multDeath=100), 
                  "IL"=list(keyState="IL", minDate="2020-08-01", multDeath=100)
                  )
purrr::walk(cfrStates, .f=function(x) onePageCFRPlot(burdenPivotList_220220$dfPivot, 
                                                     keyState=x$keyState, 
                                                     minDate=x$minDate, 
                                                     multDeath=x$multDeath
                                                     )
            )

```

The peaks and valleys plots are included:  
```{r, fig.height=9, fig.width=9}

# Burden data
cdc_daily_220220$dfPerCapita %>%
    mutate(regn=c(as.character(state.region), "South")[match(state, c(state.abb, "DC"))]) %>%
    makePeakValley(numVar=c("new_deaths", "new_cases", "inp"), 
                   windowWidth = 71, 
                   rollMean=7, 
                   facetVar=c("regn"), 
                   fnNumVar=list("new_deaths"=function(x) x, 
                                 "new_cases"=function(x) x/1000,
                                 "inp"=function(x) x/1000
                                 ), 
                   fnPeak=list("new_deaths"=function(x) x+100, 
                               "new_cases"=function(x) x+10, 
                               "inp"=function(x) x+10
                               ),
                   fnValley=list("new_deaths"=function(x) x-100, 
                                 "new_cases"=function(x) x-5, 
                                 "inp"=function(x) x-5
                                 ),
                   useTitle=c("new_deaths"="US coronavirus deaths", 
                              "new_cases"="US coronavirus cases", 
                              "inp"="US coronavirus total hospitalized"
                              ), 
                   yLab=c("new_deaths"="Rolling 7-day mean deaths", 
                          "new_cases"="Rolling 7-day mean cases (000)", 
                          "inp"="Rolling 7-day mean in hospital (000)"
                          )
                   )


# Vaccinations data for states with 8+ million population
cdc_daily_220220$dfPerCapita %>%
    inner_join(getStateData(), by=c("state")) %>%
    filter(pop >= 8000000) %>%
    select(date, state, vxa, vxc) %>%
    arrange(date, state) %>%
    group_by(state) %>%
    mutate(across(c(vxa, vxc), .fns=function(x) x-lag(x))) %>%
    ungroup() %>%
    mutate(regn=c(as.character(state.region), "South")[match(state, c(state.abb, "DC"))]) %>%
    filter(date >= "2020-12-01") %>%
    makePeakValley(numVar=c("vxc", "vxa"), 
                   windowWidth = 29, 
                   rollMean=21, 
                   facetVar=c("state"), 
                   fnNumVar=list("vxa"=function(x) x/1000, 
                                 "vxc"=function(x) x/1000
                                 ), 
                   fnPeak=list("vxa"=function(x) x+25*max(x, na.rm=TRUE)/400, 
                               "vxc"=function(x) x+25*max(x, na.rm=TRUE)/400
                               ),
                   fnValley=list("vxa"=function(x) x-25*max(x, na.rm=TRUE)/400, 
                                 "vxc"=function(x) x-25*max(x, na.rm=TRUE)/400
                                 ),
                   fnGroupFacet=TRUE,
                   useTitle=c("vxa"="Vaccines adminsitered (US)", 
                              "vxc"="Became fully vaccinated (US)"
                              ), 
                   yLab=c("vxa"="Rolling 21-day mean administered (000)",
                          "vxc"="Rolling 21-day mean completed (000)"
                          )
                   )

```

The hospital utlization plots are included:  
```{r, fig.height=9, fig.width=9}

indivHosp_20220221 %>% 
    filter(state %in% c(state.abb, "DC"), 
           collection_week==max(collection_week)
    ) %>% 
    pull(hospital_pk) %>%
    plotHospitalUtilization(df=indivHosp_20220221, keyHosp=., plotTitle="US Hospitals Summed")

```

Imputed hospital utilization data are also created, using functional form:  
```{r, fig.height=9, fig.width=9}

# Impute values for hospital capacity
imputeNACapacity <- function(df, 
                             keyStates=c(state.abb, "DC"), 
                             varMapper=hhsMapper, 
                             varsToImpute=c("total_beds", "adult_beds"), 
                             varUsedToImpute=c("inpatient_beds")
                             ) {
    
    # FUNCTION ARGUMENTS:
    # df: the initial data frame
    # keyState: states to include for filtering
    # varMapper: variables to include and output names (named vector of form c("original name"="modified name"))
    # varsToImpute: variables to be imputed
    # varUsedToImpute: percent changes in this variable assumed to drive percent changes in varsToImpute if NA
    
    df %>%
        filter(state %in% all_of(keyStates)) %>%
        colSelector(c("state", "collection_week", "hospital_pk", names(varMapper))) %>%
        colRenamer(varMapper) %>%
        mutate(across(where(is.numeric), .fns=function(x) ifelse(is.na(x), NA, ifelse(x==-999999, NA, x)))) %>%
        arrange(hospital_pk, collection_week) %>%
        group_by(hospital_pk) %>%
        mutate(across(all_of(varsToImpute), 
                      .fns=function(x) testImputeNA(x=x, y=get(varUsedToImpute), naValues=-999999)
                      )
               ) %>%
        group_by(state, collection_week) %>%
        summarize(across(where(is.numeric), .fns=sum, na.rm=TRUE), n=n(),.groups="drop")
}

modStateHosp_20220221 <- imputeNACapacity(indivHosp_20220221)

```

The function is split so that it is more generic:  
```{r, fig.height=9, fig.width=9}

# Select and filter as needed
skinnyHHS <- function(df, 
                      keyStates=c(state.abb, "DC"), 
                      idCols=c("state", "collection_week", "hospital_pk"),
                      varMapper=hhsMapper
                      ) {

    # FUNCTION ARGUMENTS:
    # df: the initial data frame
    # keyState: states to include for filtering
    # varMapper: variables to include and output names (named vector of form c("original name"="modified name"))
    
    df %>%
        filter(state %in% all_of(keyStates)) %>%
        colSelector(c(all_of(idCols), names(varMapper))) %>%
        colRenamer(varMapper)
        
}

# Impute values for hospital capacity
imputeNACapacity <- function(df, 
                             extraNA=c(-999999),
                             convertAllNA=TRUE,
                             idVars=c("hospital_pk"), 
                             sortVars=c("collection_week"),
                             varsToImpute=c("total_beds", "adult_beds"), 
                             varUsedToImpute=c("inpatient_beds")
                             ) {
    
    # FUNCTION ARGUMENTS:
    # df: the initial data frame
    # extraNA: values that should be treated as NA
    # convertAllNA: boolean, should all extraNA values be converted in all numeric columns?
    #               if FALSE, extraNA values will not be converted, though imputing will treat as NA
    # varsToImpute: variables to be imputed
    # varUsedToImpute: percent changes in this variable assumed to drive percent changes in varsToImpute if NA
    
    # Convert NA if requested
    if(isTRUE(convertAllNA)) {
        df <- df %>%
            mutate(across(where(is.numeric), 
                          .fns=function(x) ifelse(is.na(x), NA, ifelse(x %in% all_of(extraNA), NA, x))
                          )
                   )
    }
    
    # Impute values and return data
    df %>%
        arrange(across(all_of(c(idVars, sortVars)))) %>%
        group_by(across(all_of(idVars))) %>%
        mutate(across(all_of(varsToImpute), 
                      .fns=function(x) testImputeNA(x=x, y=get(varUsedToImpute), naValues=extraNA)
                      )
               ) %>%
        ungroup()
    
}

sumImputedHHS <- function(df, 
                          groupVars=c("state", "collection_week")) {
    
    # FUNCTION ARGUMENTS:
    # df: the initial data frame
    # groupVars: variables for summing the data to

    df %>%
        group_by(across(all_of(groupVars))) %>%
        summarize(across(where(is.numeric), .fns=sum, na.rm=TRUE), n=n(),.groups="drop")
    
}

identical(skinnyHHS(indivHosp_20220221) %>%
              imputeNACapacity() %>%
              sumImputedHHS(), 
          modStateHosp_20220221
          )

```

Updated maps with imputed capacity are created:  
```{r, fig.height=9, fig.width=9}

modStateHosp_20220221 <- skinnyHHS(indivHosp_20220221) %>%
    imputeNACapacity() %>%
    sumImputedHHS()

# ICU summary
createGeoMap(modStateHosp_20220221, 
             yVars=list("pctCovidICU"=c("label"="Covid", "color"="red"), 
                        "pctICU"=c("label"="Total", "color"="black")
                        ), 
             fullList=list("pctICU"=expression(icu_beds_occupied/icu_beds), 
                           "pctCovidICU"=expression(adult_icu_covid/icu_beds)
                           ), 
             plotTitle="Average % ICU Capacity Filled by Week", 
             plotSubtitle="August 2020 to January 2022", 
             plotScaleLabel="% ICU\nUsed", 
             returnData=FALSE
             )

# Adult beds summary
createGeoMap(modStateHosp_20220221 %>% filter(!(state %in% c("CT", "DE", "SD", "AK"))), 
             yVars=list("pctCovidAdult"=c("label"="Covid", "color"="red"), 
                        "pctAdult"=c("label"="Total", "color"="black")
                        ), 
             fullList=list("pctAdult"=expression(adult_beds_occupied/adult_beds), 
                           "pctCovidAdult"=expression(adult_beds_covid/adult_beds)
                           ), 
             plotTitle="Average % Adult Beds Capacity Filled by Week", 
             plotSubtitle="August 2020 to January 2022\n(AK, CT, DE, and SD data excluded)", 
             plotScaleLabel="% Adult\nBeds\nUsed", 
             returnData=FALSE
             )

```
  
## Example Data Update
The function is run to download and process the latest data:  
```{r, fig.height=9, fig.width=9, cache=TRUE}

readList <- list("cdcDaily"="./RInputFiles/Coronavirus/CDC_dc_downloaded_220304.csv", 
                 "cdcHosp"="./RInputFiles/Coronavirus/CDC_h_downloaded_220304.csv", 
                 "vax"="./RInputFiles/Coronavirus/vaxData_downloaded_220304.csv"
                 )
compareList <- list("cdcDaily"=readFromRDS("cdc_daily_220220")$dfRaw$cdcDaily, 
                    "cdcHosp"=readFromRDS("cdc_daily_220220")$dfRaw$cdcHosp, 
                    "vax"=readFromRDS("cdc_daily_220220")$dfRaw$vax
                    )

cdc_daily_220304 <- readRunCDCDaily(thruLabel="Mar 2, 2022", 
                                    downloadTo=lapply(readList, FUN=function(x) if(file.exists(x)) NA else x), 
                                    readFrom=readList,
                                    compareFile=compareList, 
                                    writeLog=NULL, 
                                    useClusters=readFromRDS("cdc_daily_210528")$useClusters, 
                                    weightedMeanAggs=c("tcpm7", "tdpm7", "cpm7", "dpm7", "hpm7", 
                                                       "vxcpm7", "vxcgte65pct"
                                                       ),
                                    skipAssessmentPlots=FALSE, 
                                    brewPalette="Paired"
                                    )
saveToRDS(cdc_daily_220304, ovrWriteError=FALSE)

# Run for latest data, save as RDS
indivHosp_20220304 <- downloadReadHospitalData(loc="./RInputFiles/Coronavirus/HHS_Hospital_20220304.csv")
saveToRDS(indivHosp_20220304, ovrWriteError=FALSE)

```
  
Post-processing is run, including hospital summaries:  
```{r, fig.height=9, fig.width=9}

# Create pivoted burden data
burdenPivotList_220304 <- postProcessCDCDaily(cdc_daily_220304, 
                                              dataThruLabel="Feb 2022", 
                                              keyDatesBurden=c("2022-02-28", "2021-08-31", 
                                                               "2021-02-28", "2020-08-31"
                                                               ),
                                              keyDatesVaccine=c("2022-02-28", "2021-10-31", 
                                                                "2021-06-30", "2021-02-28"
                                                                ), 
                                              returnData=TRUE
                                              )

# Create hospitalized per capita data
hospPerCap_220304 <- hospAgePerCapita(readFromRDS("dfStateAgeBucket2019"), 
                                      lst=burdenPivotList_220304, 
                                      popVar="pop2019", 
                                      excludeState=c(), 
                                      cumStartDate="2020-07-15"
                                      )

```

Peaks and valleys are converted to functional form:  
```{r, fig.height=9, fig.width=9}

peakValleyCDCDaily <- function(df, 
                               burdenVars=c("new_deaths", "new_cases", "inp"), 
                               burdenWidth=71, 
                               burdenRollMean=7,
                               minPopVax=8000000, 
                               vaxVars=c("vxa", "vxc"), 
                               minDateVax="2020-12-01", 
                               vaxWidth=71, 
                               vaxRollMean=21
                               ) {
    
    # FUNCTION ARGUMENTS
    # df: data frame (can also pass a list that contains data frame "dfPerCapita")
    # burdenVars: variables to be used for burden peaks and valleys
    # burdenWidth: window size to be used for burden data
    # burdenRollMean: rolling mean to use for smoothing burden data
    # minPopVax: minimum population for state vaccines to be plotted
    # vaxVars: variables to be used for vaccines peaks and valleys
    # minDateVax: earliest day to use for vaccines plotting
    # vaxWidth: window size to be used for vaccines data
    # vaxRollMean: rolling mean to use for smoothing vaccines data

    # Only works for specified burdenVars and vaxVars (fix)
    if(!all.equal(sort(burdenVars), sort(c("new_deaths", "new_cases", "inp")))) stop("\nNot yet enabled - burden\n")
    if(!all.equal(sort(vaxVars), sort(c("vxa", "vxc")))) stop("\nNot yet enabled - vaccines\n")
    
    # Extract data frame from df if needed
    if("list" %in% class(df)) df <- df[["dfPerCapita"]]

    # Burden data
    df %>%
        mutate(regn=c(as.character(state.region), "South")[match(state, c(state.abb, "DC"))]) %>%
        makePeakValley(numVar=burdenVars, 
                       windowWidth = burdenWidth, 
                       rollMean=burdenRollMean, 
                       facetVar=c("regn"), 
                       fnNumVar=list("new_deaths"=function(x) x, 
                                     "new_cases"=function(x) x/1000,
                                     "inp"=function(x) x/1000
                                     ), 
                       fnPeak=list("new_deaths"=function(x) x+100, 
                                   "new_cases"=function(x) x+10, 
                                   "inp"=function(x) x+10
                                   ),
                       fnValley=list("new_deaths"=function(x) x-100, 
                                     "new_cases"=function(x) x-5, 
                                     "inp"=function(x) x-5
                                     ),
                       useTitle=c("new_deaths"="US coronavirus deaths", 
                                  "new_cases"="US coronavirus cases", 
                                  "inp"="US coronavirus total hospitalized"
                                  ), 
                       yLab=c("new_deaths"=paste0("Rolling ", burdenRollMean, "-day mean deaths"), 
                              "new_cases"=paste0("Rolling ", burdenRollMean, "-day mean cases (000)"), 
                              "inp"=paste0("Rolling ", burdenRollMean, "-day mean in hospital (000)")
                              )
                       )

    # Vaccinations data for states with at least threshold population
    df %>%
        inner_join(getStateData(), by=c("state")) %>%
        filter(pop >= minPopVax) %>%
        select(c("state", "date", all_of(vaxVars))) %>%
        arrange(date, state) %>%
        group_by(state) %>%
        mutate(across(c(vxa, vxc), .fns=function(x) x-lag(x))) %>%
        ungroup() %>%
        mutate(regn=c(as.character(state.region), "South")[match(state, c(state.abb, "DC"))]) %>%
        filter(date >= minDateVax) %>%
        makePeakValley(numVar=vaxVars, 
                       windowWidth = vaxWidth, 
                       rollMean=vaxRollMean, 
                       facetVar=c("state"), 
                       fnNumVar=list("vxa"=function(x) x/1000, 
                                     "vxc"=function(x) x/1000
                                     ), 
                       fnPeak=list("vxa"=function(x) x+25*max(x, na.rm=TRUE)/400, 
                                   "vxc"=function(x) x+25*max(x, na.rm=TRUE)/400
                                   ),
                       fnValley=list("vxa"=function(x) x-25*max(x, na.rm=TRUE)/400, 
                                     "vxc"=function(x) x-25*max(x, na.rm=TRUE)/400
                                     ),
                       fnGroupFacet=TRUE,
                       useTitle=c("vxa"=paste0("Vaccines adminsitered (states with population >= ", minPopVax, ")"), 
                                  "vxc"=paste0("Became fully vaccinated (states with population >= ", minPopVax, ")")
                                  ), 
                       yLab=c("vxa"=paste0("Rolling ", vaxRollMean, "-day mean administered (000)"),
                              "vxc"=paste0("Rolling ", vaxRollMean,"-day mean completed (000)")
                              )
                       )
    
}

peakValleyCDCDaily(cdc_daily_220304)

```

Hospital capacity maps with imputed capacity are created:  
```{r, fig.height=9, fig.width=9}

modStateHosp_20220304 <- skinnyHHS(indivHosp_20220304) %>%
    imputeNACapacity() %>%
    sumImputedHHS()

# ICU summary
createGeoMap(modStateHosp_20220304, 
             yVars=list("pctCovidICU"=c("label"="Covid", "color"="red"), 
                        "pctICU"=c("label"="Total", "color"="black")
                        ), 
             fullList=list("pctICU"=expression(icu_beds_occupied/icu_beds), 
                           "pctCovidICU"=expression(adult_icu_covid/icu_beds)
                           ), 
             plotTitle="Average % ICU Capacity Filled by Week", 
             plotSubtitle="August 2020 to February 2022", 
             plotScaleLabel="% ICU\nUsed", 
             returnData=FALSE
             )

# Adult beds summary
createGeoMap(modStateHosp_20220304 %>% filter(!(state %in% c("CT", "DE", "SD", "AK"))), 
             yVars=list("pctCovidAdult"=c("label"="Covid", "color"="red"), 
                        "pctAdult"=c("label"="Total", "color"="black")
                        ), 
             fullList=list("pctAdult"=expression(adult_beds_occupied/adult_beds), 
                           "pctCovidAdult"=expression(adult_beds_covid/adult_beds)
                           ), 
             plotTitle="Average % Adult Beds Capacity Filled by Week", 
             plotSubtitle="August 2020 to February 2022\n(AK, CT, DE, and SD data excluded)", 
             plotScaleLabel="% Adult\nBeds\nUsed", 
             returnData=FALSE
             )

```
  
