---
title: 'Additional Coding HCF: Update #001'
author: "davegoblue"
date: "November 16, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Background
This document explores High Card Flush hands (see <https://wizardofodds.com/games/high-card-flush/>) to practice using techniques learned through multiple explorations.

## Analysis Approach
There are 52c7 potential hands in High Card Flush, though many of them are functionally equivalent to each other due to suits having no meaning in the game (spades and clubs have no inherent rank in comparison to the other).  There are several steps to the analysis approach:

1.  Compile the potential hands, suit independent, with their relative frequencies due to suits  
2.  Score each of the potential hands along the lines of a) Straight Flush, b) Flush, and c) Main Hand  
3.  Assess the degree that a given hand impacts the potential for the dealer hands (e.g., if a player has all 4 Aces then the dealer must not have any hand with an Ace)  
4.  Assess the expected value (EV) of each starting hand, and the overall game EV  
  
###_Step 1: Compile Potential Hands_  
####_Step 1a: Verify Hands and Weights_  
There are several flavors of potential hands depending on the length of the longest flush in the hand:  
  
1.  7-0-0-0 - each has a weight of 4 (any of the potential suits could be the 7)  
2.  6-1-0-0 - each has a weight of 12 (any of 4 suits as the 6 with any of 3 suits as the 1)  
3.  5-2-0-0 - each has a weight of 12 (any of the 4 suits as the 5 with any of the 3 suits as the 2)
4.  5-1-1-0 - each has a weight of 12 (any of the 4 suits as the 5 with any of the 3 suits as the 0)  
5.  4-3-0-0 - each has a weight of 12 (any of the 4 suits as the 4 with any of the 3 suits as the 3)  
6.  4-2-1-0 - each has a weight of 24 (all suits independent)  
7.  4-1-1-1 - each has a weight of 4 (any of the 4 suits as the 4)  
8.  3-3-1-0 - each has a weight of 12 (any of the 4 suits as the 1 with any of the 3 suits as the 0)  
9.  3-2-2-0 - each has a weight of 12 (any of the 4 suits as the 3 with any of the 3 suits as the 0)  
10.  3-2-1-1 - each has a weight of 12 (any of the 4 suits as the 3 with any of the 3 suits as the 2)  
11.  2-2-2-1 - each has a weight of 4 (any of the 4 suits as the 1)  
  
Assessing the total number of potential hands, we have:  
```{r}

hndTypes <- matrix(data=-1L, nrow=11, ncol=2)

hndTypes[1, ] <- c(choose(13, 7), 4)
hndTypes[2, ] <- c(choose(13, 6) * choose(13, 1), 12)
hndTypes[3, ] <- c(choose(13, 5) * choose(13, 2), 12)
hndTypes[4, ] <- c(choose(13, 5) * choose(13, 1) * choose(13, 1), 12)
hndTypes[5, ] <- c(choose(13, 4) * choose(13, 3), 12)
hndTypes[6, ] <- c(choose(13, 4) * choose(13, 2) * choose(13, 1), 24)
hndTypes[7, ] <- c(choose(13, 4) * choose(13, 1) * choose(13, 1) * choose(13, 1), 4)
hndTypes[8, ] <- c(choose(13, 3) * choose(13, 3) * choose(13, 1), 12)
hndTypes[9, ] <- c(choose(13, 3) * choose(13, 2) * choose(13, 2), 12)
hndTypes[10, ] <- c(choose(13, 3) * choose(13, 2) * choose(13, 1) * choose(13, 1), 12)
hndTypes[11, ] <- c(choose(13, 2) * choose(13, 2) * choose(13, 2) * choose(13, 1), 4)

rowMult <- hndTypes[, 1] * hndTypes[, 2]
hndName <- c(7000, 
             6100, 
             5200, 5110, 
             4300, 4210, 4111, 
             3310, 3220, 3211, 
             2221
             )
hndTypes <- cbind(hndTypes, rowMult, hndName)
colnames(hndTypes) <- c("# Hands", "Weight", "Total Hands", "Hand Class")

print(hndTypes)
print(colSums(hndTypes))
print(choose(52, 7))
print(choose(52, 7) / colSums(hndTypes)[1])

```
  
As expected, the sum-product of the number of hands and the weights is 52c7 (133,784,560).  Assessing this completely requires looking at 15,584,868 "unique" hands, a deflation of 8.6x compared to the full universe.  
  
####_Step 1b: First Order Approximation_  
As a further simplifying factor, all of the 2-card suits and 1-card suits in HCF are not germaine to the game at a first approximation (they are relevant to the extent they impact other people's potential hands from the same deck).  This is due to a 9-High 3-card qualifying rule and bonuses that depend on 3+ straight flushes.  As such, all flushes of length 2 and length 1 are identical to each other.

As such, updated weights include:  
```{r}

hndTypes <- matrix(data=-1L, nrow=11, ncol=2)

hndTypes[1, ] <- c(choose(13, 7), 4)
hndTypes[2, ] <- c(choose(13, 6), 4 * 39)  # Only the 6 cards matter, any of 4 suits, any of 39 kickers
hndTypes[3, ] <- c(choose(13, 5), 4 * 3 * choose(13, 2))  # Only the 5 cards matter, any of 4 suits, any of 13c2 kickers in any of 3 suits
hndTypes[4, ] <- c(choose(13, 5), 4 * 13 * 13 * choose(3, 2))  # Only the 5 cards matter, any of 4 suits, any of 13 kickers in each of 3c2 suits
hndTypes[5, ] <- c(choose(13, 4) * choose(13, 3), 12)  # All are of interest
hndTypes[6, ] <- c(choose(13, 4), 4 * choose(13, 2) * 3 * 13 * 2)  # Only the 4 cards matter, any of 4 suits, any of 13c2 kickers in any of 3 suits and then any of 13 kickers in any of the remaining 2 suits
hndTypes[7, ] <- c(choose(13, 4), 4 * 13 * 13 * 13)  # Only the 4 cards matter, any of 4 suits, any of 13 kickers in each of the 3 other suits
hndTypes[8, ] <- c(choose(13, 3) * choose(13, 3), choose(4, 2) * 26)  # Each of the 3 card triplets matter, available in any of 4c2 suits, with any of 26 additional cards for the kicker
hndTypes[9, ] <- c(choose(13, 3), 4 * choose(13, 2) * choose(13, 2) * choose(3, 2))  # Only the 3 cards matter, any of 4 suits, any of 13c2 kickers available in each of the 3c2 remaining suits
hndTypes[10, ] <- c(choose(13, 3), 4 * choose(13, 2) * 3 * 13 * 13)  # Only the 3 cards matter, any of 4 suits, any of 13c2 kickers in any of 3 suits, then any of 13 kickers in the other 2 suits
hndTypes[11, ] <- c(1, choose(13, 2) * choose(13, 2) * choose(13, 2) * choose(13, 1) * 4)  # No cards matter

rowMult <- hndTypes[, 1] * hndTypes[, 2]
hndName <- c(7000, 
             6100, 
             5200, 5110, 
             4300, 4210, 4111, 
             3310, 3220, 3211, 
             2221
             )
hndTypes <- cbind(hndTypes, rowMult, hndName)
colnames(hndTypes) <- c("# Hands", "Weight", "Total Hands", "Hand Class")

print(hndTypes)
print(colSums(hndTypes))
print(choose(52, 7))
print(choose(52, 7) / colSums(hndTypes)[1])

```
  
This will be a very helpful first-order approximation, since it reduces total hands for assessment to 294,295 (deflator of over 400x compared to the baseline 133.8 million hands).  Almost all of the key hands for assessment are the 4-3-0-0 and 3-3-1-0 where there is a double assessment to be made.
  
  
####_Step 1c: Create Hand Types by Number Per Suit_  
All of the possible hands by "number of cards in the suit" are created.  A full hand is simply the concatenation of one or more of these suited sub-hands in to a full 7-card hand.  For purposes of creating these hands, the following ranks will be used:  
  
* 2-10 will be given index 2-10 respectively  
* J will be given index 11  
* Q will be given index 12  
* K will be given index 13  
* A will be given index 14  
  
The Ace is a high card in this game, with the exception that the Ace can play low for a straight flush.  For example, A-2-3 is treated as an Ace-high hand with a 3-2 kicker in the main game, but is also treated as an A-2-3 3-card straight flush for the side bet.  Scoring hands that contain index 14 will require an extra steo for that side bet.  
  
The hand types include:  
```{r}

hndType7 <- t(combn(2:14, 7))
hndType6 <- t(combn(2:14, 6))
hndType5 <- t(combn(2:14, 5))
hndType4 <- t(combn(2:14, 4))
hndType3 <- t(combn(2:14, 3))
hndType2 <- t(combn(2:14, 2))
hndType1 <- t(combn(2:14, 1))

cat(paste0("The 7-card hands should have: ", choose(13, 7), " combinations\t\tACTUAL: ", nrow(hndType7)))
cat(paste0("The 6-card hands should have: ", choose(13, 6), " combinations\t\tACTUAL: ", nrow(hndType6)))
cat(paste0("The 5-card hands should have: ", choose(13, 5), " combinations\t\tACTUAL: ", nrow(hndType5)))
cat(paste0("The 4-card hands should have: ", choose(13, 4), " combinations\t\tACTUAL: ", nrow(hndType4)))
cat(paste0("The 3-card hands should have: ", choose(13, 3), " combinations\t\tACTUAL: ", nrow(hndType3)))
cat(paste0("The 2-card hands should have: ", choose(13, 2), " combinations\t\tACTUAL: ", nrow(hndType2)))
cat(paste0("The 1-card hands should have: ", choose(13, 1), " combinations\t\tACTUAL: ", nrow(hndType1)))

print(paste0("There are a total of ", nrow(hndType7) + nrow(hndType6) + nrow(hndType5) + nrow(hndType4) + nrow(hndType3) + nrow(hndType2) + nrow(hndType1), " hands to be scored"))

```
  
So, by scoring and saving the values for 5,811 hands, all of the potential 7-card hands can be created and provided with an aggregate score.  
  
###_Step 2: Score Hands_  